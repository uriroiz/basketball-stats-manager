<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”¥ Smoke Test - IBBA Pure API</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .results { font-family: monospace; }
    .success { color: #4CAF50; }
    .error { color: #f44336; }
    .metric { 
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    .metric:last-child {
      border-bottom: none;
    }
    h1 { color: #333; }
    h2 { color: #555; }
    h3 { color: #4CAF50; margin-top: 0; }
    .note {
      margin-top: 20px;
      padding: 10px;
      background: #f0f0f0;
      border-left: 4px solid #4CAF50;
      color: #666;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="test-box">
    <h1>ğŸ”¥ Smoke Test - Pure API POC</h1>
    <p>×‘×“×™×§×” ××”×™×¨×” ×©×œ ×”××¢×¨×›×ª - ××©×™×›×ª 5 ××©×—×§×™× ×-API</p>
    <p style="font-size: 14px; color: #666;">
      ×”×‘×“×™×§×” ×ª××©×•×š 5 ××©×—×§×™× ×-IBBA API, ×ª×¢×‘×“ ××ª ×”× ×ª×•× ×™× ×•×ª×¦×™×’ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×‘×¡×™×¡×™×•×ª.
    </p>
    <button id="runTest" onclick="runSmokeTest()">×”×¨×¥ ×‘×“×™×§×”</button>
  </div>

  <div id="results" class="test-box" style="display:none;">
    <h2>ğŸ“Š ×ª×•×¦××•×ª</h2>
    <div id="resultsContent"></div>
  </div>

  <!-- Load IBBA Adapter -->
  <script src="js/ibba/ibba_adapter.js"></script>
  
  <!-- Smoke Test Logic -->
  <script>
    async function runSmokeTest() {
      const resultsDiv = document.getElementById('results');
      const resultsContent = document.getElementById('resultsContent');
      const button = document.getElementById('runTest');
      
      // Disable button
      button.disabled = true;
      button.textContent = 'â³ ×˜×•×¢×Ÿ...';
      
      // Show results box
      resultsDiv.style.display = 'block';
      resultsContent.innerHTML = '<p>××ª×—×™×œ ×‘×“×™×§×”...</p>';
      
      try {
        console.log('ğŸ”¥ Starting Smoke Test...');
        console.log('='.repeat(50));
        
        // STEP 1: Initialize adapter
        console.time('â±ï¸ Total Test Time');
        const adapter = new window.IBBAAdapter();
        console.log('âœ… Adapter initialized');
        
        // STEP 2: Fetch 5 games that already happened
        console.time('â±ï¸ Fetch 5 Games');
        const now = new Date().toISOString();
        
        // Fetch more games than we need (some might be future games)
        const rawGames = await adapter.fetchGames(20, now, null);
        
        // Convert to internal format
        const allGames = rawGames.map(game => adapter.convertToInternalFormat(game));
        
        // Filter only games with player data (past games)
        const games = allGames.filter(game => 
          game.players && game.players.length > 0
        ).slice(0, 5); // Take first 5
        
        console.timeEnd('â±ï¸ Fetch 5 Games');
        console.log(`âœ… Fetched ${games.length} games with player data (from ${allGames.length} total)`);
        
        // Log first game sample
        if (games.length > 0) {
          console.log('ğŸ“ First game sample:', {
            gameId: games[0].gameId,
            date: games[0].date,
            matchup: `${games[0].homeTeam} vs ${games[0].awayTeam}`,
            score: `${games[0].homeScore}-${games[0].awayScore}`,
            playersCount: games[0].players.length
          });
        }
        
        // STEP 3: Analyze data
        console.time('â±ï¸ Data Analysis');
        
        const stats = {
          gamesCount: games.length,
          totalPlayers: 0,
          totalPoints: 0,
          totalRebounds: 0,
          totalAssists: 0,
          totalSteals: 0,
          totalBlocks: 0,
          teams: new Set()
        };
        
        games.forEach(game => {
          // Count players
          stats.totalPlayers += game.players.length;
          
          // Sum scores
          stats.totalPoints += game.homeScore + game.awayScore;
          
          // Track teams
          stats.teams.add(game.homeTeam);
          stats.teams.add(game.awayTeam);
          
          // Sum player stats
          game.players.forEach(player => {
            stats.totalRebounds += player.stats.totalRebounds || 0;
            stats.totalAssists += player.stats.assists || 0;
            stats.totalSteals += player.stats.steals || 0;
            stats.totalBlocks += player.stats.blocks || 0;
          });
        });
        
        console.timeEnd('â±ï¸ Data Analysis');
        console.timeEnd('â±ï¸ Total Test Time');
        
        // Log detailed stats
        console.log('ğŸ“Š Stats Summary:', stats);
        
        // STEP 4: Display results
        displayResults(stats, resultsContent);
        
        console.log('='.repeat(50));
        console.log('âœ… Smoke Test PASSED!');
        
      } catch (error) {
        console.error('âŒ Smoke Test FAILED:', error);
        console.error('Error details:', {
          name: error.name,
          message: error.message,
          stack: error.stack
        });
        
        resultsContent.innerHTML = `
          <div class="error">
            <h3>âŒ ×”×‘×“×™×§×” × ×›×©×œ×”!</h3>
            <p><strong>×©×’×™××”:</strong> ${error.message}</p>
            <p style="font-size: 14px; margin-top: 10px;">
              ×‘×“×•×§ ××ª ×”×§×•× ×¡×•×œ ×œ×¤×¨×˜×™× × ×•×¡×¤×™×.
            </p>
          </div>
        `;
      } finally {
        button.disabled = false;
        button.textContent = '×”×¨×¥ ×©×•×‘';
      }
    }

    function displayResults(stats, container) {
      const html = `
        <div class="results success">
          <h3>âœ… ×”×‘×“×™×§×” ×”×¦×œ×™×—×”!</h3>
          
          <div class="metric">
            <span>××©×—×§×™× ×©× ××©×›×•:</span>
            <strong>${stats.gamesCount}</strong>
          </div>
          
          <div class="metric">
            <span>×¡×”×´×› ×©×—×§× ×™×:</span>
            <strong>${stats.totalPlayers}</strong>
          </div>
          
          <div class="metric">
            <span>×××•×¦×¢ ×©×—×§× ×™× ×œ××©×—×§:</span>
            <strong>${(stats.totalPlayers / stats.gamesCount).toFixed(1)}</strong>
          </div>
          
          <div class="metric">
            <span>×¡×”×´×› × ×§×•×“×•×ª:</span>
            <strong>${stats.totalPoints}</strong>
          </div>
          
          <div class="metric">
            <span>×××•×¦×¢ × ×§×•×“×•×ª ×œ××©×—×§:</span>
            <strong>${(stats.totalPoints / stats.gamesCount).toFixed(1)}</strong>
          </div>
          
          <div class="metric">
            <span>×¡×”×´×› ×¨×™×‘××•× ×“×™×:</span>
            <strong>${stats.totalRebounds}</strong>
          </div>
          
          <div class="metric">
            <span>×¡×”×´×› ××¡×™×¡×˜×™×:</span>
            <strong>${stats.totalAssists}</strong>
          </div>
          
          <div class="metric">
            <span>×¡×”×´×› ×—×˜×™×¤×•×ª:</span>
            <strong>${stats.totalSteals}</strong>
          </div>
          
          <div class="metric">
            <span>×¡×”×´×› ×—×¡×™××•×ª:</span>
            <strong>${stats.totalBlocks}</strong>
          </div>
          
          <div class="metric">
            <span>×§×‘×•×¦×•×ª ×™×™×—×•×“×™×•×ª:</span>
            <strong>${stats.teams.size}</strong>
          </div>
          
          <div class="note">
            ğŸ“ ×‘×“×•×§ ××ª ×”×§×•× ×¡×•×œ ×œ×¤×¨×˜×™× × ×•×¡×¤×™×, ××“×“×™ ×–××Ÿ ×•×“×•×’××ª ××©×—×§
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }

    // Auto-log on page load
    console.log('ğŸ”¥ Smoke Test page loaded');
    console.log('ğŸ“ Ready to test - click "×”×¨×¥ ×‘×“×™×§×”" button');
  </script>
</body>
</html>

